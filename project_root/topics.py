"""Lightweight topic extraction for discussion bias."""

from __future__ import annotations

from typing import Dict, List

MIN_TEXT_LEN = 25

TOPIC_KEYWORDS: Dict[str, List[str]] = {
    "политика": ["политик", "выбор", "власть", "закон", "парти", "санкц"],
    "экономика": ["эконом", "рынок", "инфляц", "валют", "курс", "бюджет"],
    "финансы": ["финанс", "кредит", "долг", "налог", "ставк"],
    "бизнес": ["бизнес", "компан", "предприним", "бренд", "рынк"],
    "рынки": ["акци", "облигац", "индекс", "s&p", "nasdaq", "бирж"],
    "крипта": ["биткоин", "bitcoin", "крипт", "altcoin", "токен", "бинанс"],
    "технологии": ["техно", "стартап", "айти", "нейросет", "искусственный интеллект", "софт"],
    "it": ["айти", "it", "devops", "backend", "frontend"],
    "общество": ["общество", "соц", "права", "семь", "населен"],
    "образование": ["школ", "универс", "образован", "ученик", "преподав"],
    "здоровье": ["здоров", "медицин", "больниц", "лечен", "врач"],
    "психология": ["психолог", "стресс", "эмоци", "тревог", "выгора"],
    "культура": ["культур", "театр", "музык", "литератур", "концерт"],
    "кино": ["кино", "фильм", "режисс", "актёр", "сценар"],
    "сериалы": ["сериал", "сезон", "стриминг", "эпизод"],
    "искусство": ["искусств", "живопис", "выставк", "музей"],
    "медиа": ["медиа", "сми", "журналист", "редакц", "канал"],
    "соцсети": ["соцсет", "социальн", "инстаграм", "тик ток", "телеграм"],
    "спорт": ["спорт", "матч", "турнир", "лига", "чемпионат"],
    "футбол": ["футбол", "гол", "пенальти", "трансфер"],
    "киберспорт": ["киберспорт", "esports", "стример", "гейм", "турнир"],
    "безопасность": ["безопасн", "войн", "армия", "оборон", "теракт", "нападен"],
    "армия": ["армия", "военн", "солдат", "част", "мобилиз"],
    "конфликты": ["конфликт", "эскалац", "обстрел", "фронт", "боев"],
    "геополитика": ["геополит", "альянс", "санкц", "дипломат"],
    "город": ["город", "улиц", "район", "транспорт", "парк"],
    "урбанистика": ["урбанист", "инфраструктур", "транспорт", "реконстр"],
    "интернет": ["интернет", "сайт", "сервис", "онлайн", "провайдер"],
}


def extract_topics_for_text(text: str, max_topics: int = 3) -> List[str]:
    """Return topic tags detected in text (no OpenAI)."""
    if not text:
        return []
    normalized = text.strip().lower()
    if len(normalized) < MIN_TEXT_LEN:
        return []
    counts: Dict[str, int] = {}
    for topic, keywords in TOPIC_KEYWORDS.items():
        score = 0
        for keyword in keywords:
            if keyword in normalized:
                score += normalized.count(keyword)
        if score > 0:
            counts[topic] = score
    if not counts:
        return []
    ranked = sorted(counts.items(), key=lambda item: item[1], reverse=True)
    return [topic for topic, _ in ranked[:max_topics]]
